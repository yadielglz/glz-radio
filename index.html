<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark">
    <title>GLZ Radio</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css">
    
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        
        .app-container {
            max-width: 400px;
            min-height: 600px;
        }
        
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        #splash-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        #station-carousel-container {
            perspective: 1000px;
        }

        #station-carousel {
            transform-style: preserve-3d;
        }
        
        .station-item {
            flex: 0 0 100px;
            text-align: center;
            margin: 0 10px;
            transition: transform 0.4s ease, opacity 0.4s ease;
            background: transparent;
            border: none;
            padding: 0;
        }

        .station-logo {
            width: 80px;
            height: 80px;
            border-radius: 1.5rem; /* rounded-3xl */
            object-fit: contain;
            margin: 0 auto 8px;
            transition: filter 0.3s ease;
        }

        .station-item.active .station-logo {
            filter: drop-shadow(0 0 10px rgba(199, 210, 254, 0.7)); /* indigo-200 glow */
        }

        .station-name {
            font-size: 0.875rem; /* text-sm */
            font-weight: 600; /* font-semibold */
            color: #d1d5db; /* text-gray-300 */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .display-view {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }

        .display-view.hidden {
            opacity: 0;
            pointer-events: none;
            position: absolute;
            transform: scale(0.95);
        }

        /* Custom Tuner Slider */
        #tuner-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            outline: none;
            transition: opacity .2s;
        }

        #tuner-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #a5b4fc; /* indigo-300 */
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #1e1b4b;
        }

        #tuner-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #a5b4fc; /* indigo-300 */
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #1e1b4b;
        }
    </style>
</head>
<body class="text-white font-sans flex items-center justify-center p-4">

    <!-- Splash Screen -->
    <div id="splash-screen">
        <div class="text-center">
            <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-2xl flex items-center justify-center">
                <i data-lucide="radio" class="w-8 h-8 text-white"></i>
            </div>
            <h1 class="text-2xl font-bold mb-2">GLZ Radio</h1>
            <p class="text-gray-400">Loading...</p>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="app-container w-full glass rounded-3xl shadow-2xl p-6 relative" style="display: none;">
        
        <!-- Top Bar -->
        <header class="flex items-center justify-between mb-6 text-sm">
            <div id="time-display" class="w-20 text-left"></div>
            <div id="rds-display" class="flex-1 text-center font-semibold truncate">
                <span id="rds-text">GLZ Radio</span>
            </div>
            <div id="connection-status" class="w-20 text-right">
                <i data-lucide="wifi" class="w-4 h-4 text-green-400 inline-block"></i>
            </div>
        </header>

        <!-- Tuner Bar -->
        <div class="w-full mb-6 relative">
            <input type="range" id="tuner-slider" min="0" value="0">
            <div id="tuner-labels" class="w-full h-4 flex mt-1">
                <!-- Labels will be generated here -->
            </div>
        </div>

        <!-- Player Display -->
        <div class="glass rounded-3xl p-6 mb-6 h-48 flex flex-col justify-center relative">
            <div id="station-carousel-container" class="display-view w-full overflow-hidden">
                <div id="station-carousel" class="flex transition-transform duration-300 ease-in-out">
                    <!-- Station items will be injected here -->
                </div>
            </div>
            <div id="now-playing-container" class="display-view hidden w-full text-center">
                <!-- Now playing info will be injected here -->
            </div>
            <p id="status-display" class="text-sm text-center text-gray-400 mt-2 absolute bottom-4 left-0 right-0"></p>
        </div>

        <!-- Controls -->
        <div class="flex items-center justify-center space-x-6 mb-6">
            <button id="play-btn" class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-full flex items-center justify-center hover:scale-105 transition-transform">
                <i data-lucide="play" class="w-8 h-8 ml-1"></i>
            </button>
            
            <button id="stop-btn" class="w-16 h-16 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center hover:scale-105 transition-transform" style="display: none;">
                <i data-lucide="square" class="w-8 h-8"></i>
            </button>
        </div>

        <footer id="app-footer" class="text-center text-xs text-gray-500 absolute bottom-4 left-0 right-0"></footer>
    </div>

    <!-- Audio Element -->
    <audio id="audio-player" preload="none"></audio>

    <!-- Load Configuration -->
    <script src="js/config.js"></script>

    <!-- Simple App Script -->
    <script>
        // Simple app state
        const app = {
            isPlaying: false,
            currentStation: null,
            audio: document.getElementById('audio-player'),
            rdsInterval: null,
            rdsTextIndex: 0,
        };

        // DOM elements
        const elements = {
            splash: document.getElementById('splash-screen'),
            app: document.getElementById('app'),
            playBtn: document.getElementById('play-btn'),
            stopBtn: document.getElementById('stop-btn'),
            statusDisplay: document.getElementById('status-display'),
            timeDisplay: document.getElementById('time-display'),
            rdsDisplay: document.getElementById('rds-display'),
            rdsText: document.getElementById('rds-text'),
            connectionStatus: document.getElementById('connection-status'),
            tunerSlider: document.getElementById('tuner-slider'),
            stationCarousel: document.getElementById('station-carousel'),
            tunerTicks: document.getElementById('tuner-ticks'),
            carouselContainer: document.getElementById('station-carousel-container'),
            nowPlayingContainer: document.getElementById('now-playing-container'),
            tunerLabels: document.getElementById('tuner-labels'),
            appFooter: document.getElementById('app-footer'),
        };

        // Initialize app
        function init() {
            console.log('Initializing GLZ Radio...');
            
            // Initialize Lucide icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // Setup tuner
            elements.tunerSlider.max = STATIONS_ORDER.length - 1;
            createTunerLabels();

            // Populate carousel
            populateCarousel();

            // Set footer
            setAppFooter();

            // Setup event listeners
            setupEventListeners();
            
            // Start clock
            updateTime();
            setInterval(updateTime, 1000);

            // Set initial RDS display
            clearRdsDisplay();

            // Hide splash screen
            setTimeout(() => {
                elements.splash.classList.add('hidden');
                elements.app.style.display = 'block';
                console.log('App loaded successfully');
            }, 1500);
        }

        // Setup event listeners
        function setupEventListeners() {
            elements.playBtn.addEventListener('click', togglePlay);
            elements.stopBtn.addEventListener('click', stopPlayer);

            elements.tunerSlider.addEventListener('input', (e) => {
                const stationIndex = parseInt(e.target.value, 10);
                const stationName = STATIONS_ORDER[stationIndex];
                selectStation(stationName);
                updateCarousel(stationIndex);
            });

            // Audio events
            app.audio.addEventListener('loadstart', () => updateStatus('Loading...'));
            app.audio.addEventListener('canplay', () => updateStatus('Ready'));
            app.audio.addEventListener('playing', () => updateStatus('Playing'));
            app.audio.addEventListener('error', () => updateStatus('Error'));
        }

        // Select station
        function selectStation(stationName) {
            if (!RADIO_STATIONS[stationName]) return;
            
            app.currentStation = stationName;
            const station = RADIO_STATIONS[stationName];
            setRdsFrequency(station);

            // Update tuner slider
            const stationIndex = STATIONS_ORDER.indexOf(stationName);
            if (stationIndex > -1) {
                elements.tunerSlider.value = stationIndex;
                updateCarousel(stationIndex);
            }

            // If playing, start new station
            if (app.isPlaying) {
                playPlayer();
            }
        }

        // Toggle play/pause
        function togglePlay() {
            if (app.isPlaying) {
                pausePlayer();
            } else {
                if (app.currentStation) {
                    playPlayer();
                }
            }
        }

        // Play player
        function playPlayer() {
            const station = RADIO_STATIONS[app.currentStation];
            if (!station) return;

            app.audio.src = station.streamUrl;
            app.audio.play().catch(e => {
                console.error('Error playing audio:', e);
                updateStatus('Playback Error');
            });
            
            app.isPlaying = true;
            elements.playBtn.style.display = 'none';
            elements.stopBtn.style.display = 'flex';
            updateStatus('Connecting...');
            showNowPlayingView(station);
            startRdsRotation(station);
        }

        // Pause player (for now, same as stop)
        function pausePlayer() {
            app.audio.pause();
            app.isPlaying = false;
            elements.playBtn.innerHTML = '<i data-lucide="play" class="w-8 h-8 ml-1"></i>';
            if (typeof lucide !== 'undefined') lucide.createIcons();
            elements.playBtn.style.display = 'flex';
            elements.stopBtn.style.display = 'none';
            updateStatus('Paused');
            
            const station = RADIO_STATIONS[app.currentStation];
            if (station) {
                setRdsFrequency(station);
            }
        }

        // Stop player
        function stopPlayer() {
            app.audio.pause();
            app.audio.src = '';
            app.isPlaying = false;
            elements.playBtn.style.display = 'flex';
            elements.stopBtn.style.display = 'none';
            updateStatus('Select a Station');
            app.currentStation = null;
            clearRdsDisplay();
            showCarouselView();
        }

        // Update status display
        function updateStatus(message) {
            elements.statusDisplay.textContent = message;
        }

        // Update time display
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            if (elements.timeDisplay) {
                elements.timeDisplay.textContent = timeString;
            }
        }

        function setRdsFrequency(station) {
            clearInterval(app.rdsInterval);
            let frequency = station.frequency;
            if (frequency === 'Satellite Radio') {
                frequency = 'Internet';
            }
            elements.rdsText.textContent = frequency;
        }

        function startRdsRotation(station) {
            clearInterval(app.rdsInterval);

            if (station.rdsText && station.rdsText.length > 0) {
                app.rdsTextIndex = 0;
                elements.rdsText.textContent = station.rdsText[app.rdsTextIndex];

                if (station.rdsText.length > 1) {
                    app.rdsInterval = setInterval(() => {
                        app.rdsTextIndex = (app.rdsTextIndex + 1) % station.rdsText.length;
                        elements.rdsText.textContent = station.rdsText[app.rdsTextIndex];
                    }, 4000);
                }
            } else {
                // Fallback to frequency if no rdsText is available
                setRdsFrequency(station);
            }
        }

        function clearRdsDisplay() {
            clearInterval(app.rdsInterval);
            elements.rdsText.textContent = 'GLZ Radio';
        }

        // Carousel functions
        function populateCarousel() {
            const carousel = elements.stationCarousel;
            carousel.innerHTML = '';
            STATIONS_ORDER.forEach((stationName, index) => {
                const station = RADIO_STATIONS[stationName];
                const item = document.createElement('div');
                item.className = 'station-item';
                item.dataset.index = index;
                item.innerHTML = `
                    <img src="${station.logo}" alt="${stationName}" class="station-logo">
                    <p class="station-name">${stationName}</p>
                `;
                item.addEventListener('click', () => {
                    selectStation(stationName);
                });
                carousel.appendChild(item);
            });
        }

        function updateCarousel(activeIndex) {
            const carousel = elements.stationCarousel;
            const items = carousel.querySelectorAll('.station-item');
            if (items.length === 0) return;
            
            // Center the active item
            const container = elements.stationCarousel.parentElement;
            const targetItem = items[activeIndex];
            const scrollLeft = targetItem.offsetLeft + (targetItem.offsetWidth / 2) - (container.offsetWidth / 2);
            
            container.scrollTo({
                left: scrollLeft,
                behavior: 'smooth'
            });

            // Apply 3D transforms
            items.forEach((item, index) => {
                const distance = index - activeIndex;
                const absDistance = Math.abs(distance);
                
                const scale = 1 - (absDistance * 0.15);
                const rotateY = distance * -20;
                const translateX = distance * 20;
                const opacity = 1 - (absDistance * 0.3);
                
                item.style.transform = `translateX(${translateX}px) scale(${scale}) rotateY(${rotateY}deg)`;
                item.style.opacity = opacity;

                if (index === activeIndex) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        // Tuner ticks and labels
        function getBandRanges() {
            const ranges = { am: { start: -1, end: -1 }, fm: { start: -1, end: -1 }, sat: { start: -1, end: -1 } };
            
            STATIONS_ORDER.forEach((stationName, index) => {
                const station = RADIO_STATIONS[stationName];
                let band;
                if (station.frequency.includes('AM')) {
                    band = 'am';
                } else if (station.frequency.includes('FM')) {
                    band = 'fm';
                } else {
                    band = 'sat';
                }

                if (ranges[band].start === -1) {
                    ranges[band].start = index;
                }
                ranges[band].end = index;
            });
            return ranges;
        }

        function createTunerLabels() {
            const labelsContainer = elements.tunerLabels;
            labelsContainer.innerHTML = '';
            const totalStations = STATIONS_ORDER.length;

            const bandRanges = getBandRanges();

            const bands = [
                { key: 'am', label: 'AM' },
                { key: 'fm', label: 'FM' },
                { key: 'sat', label: 'SAT' },
            ];

            bands.forEach(bandInfo => {
                const range = bandRanges[bandInfo.key];
                if (range.start !== -1) {
                    const stationCount = range.end - range.start + 1;
                    const percentage = (stationCount / totalStations) * 100;

                    const labelEl = document.createElement('div');
                    labelEl.className = 'text-xs font-mono text-center text-gray-400 border-r border-gray-600 last:border-r-0';
                    labelEl.style.width = `${percentage}%`;
                    labelEl.textContent = bandInfo.label;
                    labelsContainer.appendChild(labelEl);
                }
            });
        }

        function showCarouselView() {
            elements.carouselContainer.classList.remove('hidden');
            elements.nowPlayingContainer.classList.add('hidden');
        }

        function showNowPlayingView(station) {
            elements.carouselContainer.classList.add('hidden');
            elements.nowPlayingContainer.classList.remove('hidden');

            const stationName = app.currentStation;
            const callSign = station.callSign || 'none';
            let frequency = station.frequency;
            if (frequency === 'Satellite Radio') {
                frequency = 'Internet';
            }

            elements.nowPlayingContainer.innerHTML = `
                <div class="flex items-center w-full h-full">
                    <img src="${station.logo}" alt="${stationName}" class="w-24 h-24 rounded-2xl object-contain bg-black/20 p-1 flex-shrink-0">
                    <div class="ml-4 text-left flex-1 truncate">
                        <p class="text-lg font-bold truncate">${stationName}</p>
                        <p class="text-base text-gray-300">${frequency}</p>
                        <p class="text-sm font-mono text-gray-400">${callSign}</p>
                    </div>
                </div>
            `;
        }

        function setAppFooter() {
            const now = new Date();
            const year = String(now.getFullYear()).slice(-2);
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            
            const buildTimestamp = `${year}.${month}.${day}-${hours}${minutes}`;
            const version = '6.1';
            
            elements.appFooter.textContent = `Glz Technical Systems : Ver ${version} : Build: ${buildTimestamp}`;
        }

        // Start the app
        document.addEventListener('DOMContentLoaded', init);
    </script>

</body>
</html>
